<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Bewerbungsformular – Info Website 2025</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >

  <!-- Deine globalen Styles -->
  <link rel="stylesheet" href="styles.css">

  <style>
    body {
      min-height: 100vh;
      background:
        radial-gradient(900px 700px at 10% 0%, rgba(13,110,253,.18), transparent 70%),
        radial-gradient(900px 700px at 90% 100%, rgba(0,255,200,.12), transparent 70%),
        #050814;
      color: #e5f1ff;
    }

    .page-title {
      color: #d9e9ff;
      text-shadow: 0 4px 24px rgba(0,0,0,.55);
    }

    .form-wrapper {
      max-width: 850px;
      margin: 0 auto;
    }

    .form-card {
      background: rgba(12, 18, 32, 0.9);
      border-radius: 1.25rem;
      border: 1px solid rgba(0, 255, 200, 0.16);
      box-shadow:
        0 1.5rem 3rem rgba(0,0,0,.55),
        0 0 25px rgba(0,255,200,.12);
      backdrop-filter: blur(14px);
    }

    .section-label {
      font-size: .9rem;
      font-weight: 600;
      letter-spacing: .08em;
      text-transform: uppercase;
      color: #7ea8ff;
      margin-bottom: .35rem;
    }

    .form-control,
    .form-select {
        background: rgba(7, 12, 26, 0.9);
        border-radius: .8rem;
        border: 1px solid rgba(134, 162, 255, .55);
        color: #ffffff !important;          /* <– immer weisse Schrift */
        box-shadow: inset 0 0 0 rgba(0,0,0,0);
        transition: border-color .2s ease, box-shadow .2s ease, background .2s ease, transform .08s ease;
        caret-color: #00ffc8;               /* Cursor-Farbe (optional) */
    }

    .form-control::placeholder,
    .form-select::placeholder {
        color: rgba(214, 228, 255, .6);
    }

    /* Autofill Fix (Chrome/Safari) */
    input:-webkit-autofill,
    textarea:-webkit-autofill,
    select:-webkit-autofill {
      -webkit-text-fill-color: #ffffff !important;
      transition: background-color 9999s ease-in-out 0s;
      box-shadow: 0 0 0px 1000px rgba(7, 12, 26, 0.9) inset !important;
    }

.form-control:focus,
.form-select:focus {
  background: rgba(10, 18, 38, 0.98);
  border-color: #00ffc8;
  box-shadow: 0 0 0 .15rem rgba(0,255,200,.35);
  transform: translateY(-1px);
  color: #ffffff !important;          /* <– auch beim Tippen weiss */
}

    .form-control.is-invalid,
    .form-select.is-invalid {
      border-color: #ff6b81;
      box-shadow: 0 0 0 .15rem rgba(255,107,129,.35);
    }

    .form-text,
    .text-muted {
      color: #9fb4d8 !important;
    }

    .btn-send {
      border-radius: 999px;
      padding: 0.85rem 2.2rem;
      font-weight: 700;
      letter-spacing: .03em;
      background: linear-gradient(135deg, #00ffc8, #008cff);
      border: none;
      color: #04121f;
      box-shadow:
        0 1rem 2rem rgba(0,255,200,.24),
        0 0 20px rgba(0,255,200,.3);
      transition: transform .15s ease, box-shadow .15s ease, filter .15s ease;
    }

    .btn-send:hover {
      transform: translateY(-1px) scale(1.02);
      filter: brightness(1.07);
      box-shadow:
        0 1.3rem 2.6rem rgba(0,255,200,.32),
        0 0 26px rgba(0,255,200,.4);
    }

    .btn-send:active {
      transform: translateY(0) scale(.99);
      box-shadow: 0 .5rem 1.4rem rgba(0,0,0,.6);
    }

    .form-check-input {
      cursor: pointer;
    }
    .form-check-input:focus {
      box-shadow: 0 0 0 .16rem rgba(0,255,200,.35);
      border-color: #00ffc8;
    }
    .form-check-input:checked {
      background-color: #00ffc8;
      border-color: #00ffc8;
    }

    .invalid-feedback {
      font-size: .8rem;
    }
  </style>
</head>

<body data-page="bewerbung">
  <div id="site-nav"></div>

  <main class="container py-5">
    <div class="form-wrapper">
      <header class="text-center mb-4">
        <h1 class="page-title display-6 fw-bold mb-2">Bewerbungsformular Praktikum</h1>
        <p class="text-muted mb-0">
          Fülle das Formular sorgfältig aus. Felder mit * sind Pflichtfelder.
        </p>
      </header>

      <div class="form-card p-4 p-md-5">
        <form id="applyForm" class="needs-validation" novalidate>
          <!-- Personendaten -->
          <div class="mb-3">
            <div class="section-label">Personendaten</div>
            <hr class="mt-1 mb-3 border-secondary">
          </div>

          <div class="row g-3 mb-3">
            <div class="col-sm-4">
              <label for="gender" class="form-label">Geschlecht *</label>
              <select id="gender" name="gender" class="form-select" required>
                <option value="">Bitte wählen...</option>
                <option value="w">Weiblich</option>
                <option value="m">Männlich</option>
                <option value="d">Divers</option>
                <option value="kA">Keine Angabe</option>
              </select>
              <div class="invalid-feedback">Bitte ein Geschlecht auswählen.</div>
            </div>

            <div class="col-sm-4">
              <label for="firstname" class="form-label">Vorname *</label>
              <input
                type="text"
                class="form-control"
                id="firstname"
                name="firstname"
                required
              >
              <div class="invalid-feedback">Bitte Vornamen angeben.</div>
            </div>

            <div class="col-sm-4">
              <label for="lastname" class="form-label">Name *</label>
              <input
                type="text"
                class="form-control"
                id="lastname"
                name="lastname"
                required
              >
              <div class="invalid-feedback">Bitte Nachnamen angeben.</div>
            </div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-8">
              <label for="street" class="form-label">Strasse und Nr. *</label>
              <input
                type="text"
                class="form-control"
                id="street"
                name="street"
                required
              >
              <div class="invalid-feedback">Bitte Strasse und Nummer angeben.</div>
            </div>
            <div class="col-md-4">
              <label for="zipcity" class="form-label">PLZ und Ort *</label>
              <input
                type="text"
                class="form-control"
                id="zipcity"
                name="zipcity"
                placeholder="8400 Winterthur"
                required
              >
              <div class="invalid-feedback">Bitte PLZ und Ort angeben.</div>
            </div>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label for="birthdate" class="form-label">Geburtsdatum *</label>
              <input
                type="date"
                class="form-control"
                id="birthdate"
                name="birthdate"
                required
              >
              <div class="invalid-feedback">Bitte Geburtsdatum angeben.</div>
            </div>
          </div>

          <!-- Kontakt -->
          <div class="mb-3 mt-4">
            <div class="section-label">Kontakt</div>
            <hr class="mt-1 mb-3 border-secondary">
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="email" class="form-label">E-Mail *</label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                required
              >
              <div class="invalid-feedback">Bitte eine gültige E-Mail-Adresse eingeben.</div>
            </div>
            <div class="col-md-6">
              <label for="phone" class="form-label">Handy-Nummer *</label>
              <input
                type="tel"
                class="form-control"
                id="phone"
                name="phone"
                placeholder="+41 79 123 45 67"
                pattern="[0-9+ ]{8,20}"
                required
              >
              <div class="invalid-feedback">Bitte gültige Handy-Nummer eingeben.</div>
            </div>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <label for="contactPref" class="form-label">Bevorzugte Art der Kontaktaufnahme *</label>
              <select
                id="contactPref"
                name="contactPref"
                class="form-select"
                required
              >
                <option value="">Bitte wählen...</option>
                <option value="mail">E-Mail</option>
                <option value="phone">Telefon</option>
                <option value="sms">SMS / Messenger</option>
              </select>
              <div class="invalid-feedback">Bitte eine Kontaktart auswählen.</div>
            </div>
          </div>

          <!-- Bewerbung -->
          <div class="mb-3 mt-4">
            <div class="section-label">Bewerbung</div>
            <hr class="mt-1 mb-3 border-secondary">
          </div>

          <div class="mb-3">
            <label for="motivation" class="form-label">Motivationsschreiben *</label>
            <textarea
              class="form-control"
              id="motivation"
              name="motivation"
              rows="5"
              minlength="50"
              maxlength="4000"
              placeholder="Warum möchtest du dieses Praktikum? Was bringst du mit?"
              required
            ></textarea>
            <div class="form-text">
              Mindestens ca. 50 Zeichen. Erzähle kurz deine Motivation.
            </div>
            <div class="invalid-feedback">Bitte ein Motivationsschreiben verfassen.</div>
          </div>

          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <label for="cv" class="form-label">Lebenslauf (PDF Upload) *</label>
              <input
                type="file"
                class="form-control"
                id="cv"
                name="cv"
                accept="application/pdf"
                required
              >
              <div class="form-text">Nur PDF-Dateien.</div>
              <div class="invalid-feedback">Bitte Lebenslauf als PDF hochladen.</div>
            </div>

            <div class="col-md-6">
              <label for="portfolio" class="form-label">Link zu Portfolio</label>
              <input
                type="url"
                class="form-control"
                id="portfolio"
                name="portfolio"
                placeholder="https://mein-portfolio.example"
              >
              <div class="invalid-feedback">Bitte eine gültige URL oder Feld leer lassen.</div>
            </div>
          </div>

<!-- Datenschutz -->
<div class="mb-3 mt-4">
  <div class="section-label">Datenschutz</div>
  <hr class="mt-1 mb-3 border-secondary">
</div>

<div class="mb-3">
  <p class="text-muted mb-1">
    Bitte lies die 
    <a href="datenschutz.html" target="_blank" class="link-info text-decoration-underline">
      Datenschutzbestimmungen
    </a>
    sorgfältig durch.
  </p>

  <div class="form-check mt-2">
    <input
      class="form-check-input"
      type="checkbox"
      value="1"
      id="privacy"
      name="privacy"
      required
    >
    <label class="form-check-label" for="privacy">
      Ich habe die Datenschutzbestimmungen gelesen und akzeptiere sie. *
    </label>

    <div class="invalid-feedback">
      Du musst die Datenschutzbestimmungen akzeptieren, um die Bewerbung zu senden.
    </div>
  </div>
</div>

          <!-- Submit -->
          <div class="mt-4 text-center">
            <button type="submit" class="btn btn-send">
              ✉️ Bewerbung absenden
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <!-- JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Bootstrap-Style Validation (nur Styling; Submit-Handling macht der Firebase-Handler unten)
    (() => {
      "use strict";
      const forms = document.querySelectorAll(".needs-validation");
      Array.from(forms).forEach(form => {
        form.addEventListener("submit", () => {
          form.classList.add("was-validated");
        }, false);
      });
    })();
  </script>
  <script type="module">
    // ==== Firebase: Bewerbung speichern (Firestore + Storage) ====
    // Wichtig:
    // 1) In Firebase Console -> Firestore Database und Storage aktivieren.
    // 2) Für Demo: Regeln im Testmodus (später härten).

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
    import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
    import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

    // Firebase-Konfiguration (aus deiner Firebase Web-App)
    const firebaseConfig = {
      apiKey: "AIzaSyD-RF0L27hfVvSDmsXI2U4vnPSRpNjJFQlw",
      authDomain: "website1-e10d5.firebaseapp.com",
      projectId: "website1-e10d5",
      storageBucket: "website1-e10d5.firebasestorage.app",
      messagingSenderId: "522686025252",
      appId: "1:522686025252:web:9d1374476fb1202f7392b1",
      measurementId: "G-27PKVDJPKP"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const storage = getStorage(app);

    const form = document.getElementById("applyForm");

    // kleine UX-Helfer
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalBtnText = submitBtn ? submitBtn.innerHTML : "";

    function setLoading(isLoading) {
      if (!submitBtn) return;
      submitBtn.disabled = isLoading;
      submitBtn.innerHTML = isLoading
        ? '⏳ Sende Bewerbung...'
        : originalBtnText;
    }

    function genderToLabel(val) {
      return val === "w" ? "Weiblich" :
             val === "m" ? "Männlich" :
             val === "d" ? "Divers" :
             val === "kA" ? "Keine Angabe" : "";
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      event.stopPropagation();

      // HTML5 Validierung
      if (!form.checkValidity()) {
        form.classList.add("was-validated");
        return;
      }

      setLoading(true);

      try {
        // Werte sammeln
        const genderVal = document.getElementById("gender").value;
        const firstname = document.getElementById("firstname").value.trim();
        const lastname  = document.getElementById("lastname").value.trim();
        const street    = document.getElementById("street").value.trim();
        const zipcity   = document.getElementById("zipcity").value.trim();
        const birthdate = document.getElementById("birthdate").value; // YYYY-MM-DD
        const email     = document.getElementById("email").value.trim();
        const phone     = document.getElementById("phone").value.trim();
        const contactPref = document.getElementById("contactPref").value;
        const motivation  = document.getElementById("motivation").value.trim();
        const portfolio   = document.getElementById("portfolio").value.trim() || null;
        const privacyAccepted = document.getElementById("privacy").checked;

        const cvFile = document.getElementById("cv").files?.[0] || null;
        if (!cvFile) {
          // sollte durch required eh nicht passieren
          throw new Error("Bitte Lebenslauf (PDF) auswählen.");
        }

        // 1) PDF nach Firebase Storage hochladen
        const safeName = `${firstname}_${lastname}`.trim().replace(/\s+/g, "_").replace(/[^a-zA-Z0-9_\-]/g, "");
        const ts = Date.now();
        const storagePath = `applications/${safeName || "bewerbung"}_${ts}_${cvFile.name}`;
        const fileRef = ref(storage, storagePath);

        await uploadBytes(fileRef, cvFile, { contentType: cvFile.type || "application/pdf" });
        const cvUrl = await getDownloadURL(fileRef);

        // 2) Daten in Firestore speichern
        const docPayload = {
          title: `${firstname} ${lastname}`.trim(),

          geschlecht: genderToLabel(genderVal),
          vorname: firstname,
          nachname: lastname,
          strasse_und_nr: street,
          plz_und_ort: zipcity,
          geburtsdatum: birthdate,

          email,
          handy_nummer: phone,
          kontakt_preferenz: contactPref,

          motivationsschreiben: motivation,
          portfolio_link: portfolio,

          datenschutz_akzeptiert: privacyAccepted,

          status: "Eingegangen", // Aufgabe 4 (Kanban/Status)

          cv: {
            filename: cvFile.name,
            storagePath,
            url: cvUrl
          },

          createdAt: serverTimestamp()
        };

        await addDoc(collection(db, "applications"), docPayload);

        alert("Bewerbung wurde gespeichert ✅");
        form.reset();
        form.classList.remove("was-validated");

      } catch (err) {
        console.error(err);
        alert(`Speichern fehlgeschlagen ❌\n${err?.message || err}`);
      } finally {
        setLoading(false);
      }
    });
  </script>
  <script>
    fetch('nav.html')
      .then(res => {
        if (!res.ok) throw new Error('Nav konnte nicht geladen werden');
        return res.text();
      })
      .then(html => {
        document.getElementById('site-nav').innerHTML = html;
      })
      .catch(err => console.error(err));
  </script>
</body>
</html>