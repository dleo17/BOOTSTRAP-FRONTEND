<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Aktuelles Live Wetter â€“ Info Website 2025</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">

  <style>
    #weatherChart {
      width: 100%;
      height: 320px;
      border: 1px solid rgba(0,0,0,.1);
      border-radius: .5rem;
      background: #fff;
    }
  </style>
</head>
<body data-page="weather" class="bg-light">
  <div id="site-nav"></div>

  <main class="container my-4">
    <h1 class="display-6 fw-bold mb-4 text-center">Aktuelles Live Wetter</h1>

    <!-- Abschnitt 1: Heutige Werte -->
    <div class="text-center mb-3">
      <button id="btnWeather" class="btn btn-primary pill-btn">Wetter anzeigen</button>
    </div>

    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <div id="weatherResult" class="placeholder-box p-3">
          <span class="text-muted">Wetterdaten folgenâ€¦</span>
        </div>
      </div>
    </div>

    <!-- Abschnitt 2: Diagramm -->
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-3">
          <h5 class="card-title mb-2 mb-md-0 fw-semibold">Vorhersage (nÃ¤chste 5 Tage)</h5>
          <button id="btnChart" class="btn btn-outline-primary btn-sm">Diagramm laden</button>
        </div>

        <div id="chartStatus" class="text-muted small mb-2">
          Noch kein Diagramm geladenâ€¦
        </div>

        <div id="weatherChart" class="d-flex align-items-center justify-content-center text-muted">
          Chart folgtâ€¦
        </div>

        <div class="text-muted small mt-3">
          Temperatur (Â°C, Linie) &nbsp;|&nbsp; Niederschlag (mm, SÃ¤ulen) &nbsp;|&nbsp; Datenquelle: Open-Meteo / MeteoSwiss
        </div>
      </div>
    </div>

  </main>

  <!-- jQuery / Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Highcharts -->
  <script src="https://code.highcharts.com/highcharts.js"></script>

  <!-- Gemeinsames App-Skript (fÃ¼r Navbar laden etc.) -->
  <script src="app.js"></script>

  <script>
  // Fixe Koordinaten ZÃ¼rich
  const LAT = 47.3769;
  const LON = 8.5417;

  // =========================
  // Teil 1: Tageswerte (heute)
  // =========================
  $('#btnWeather').on('click', function () {
    const $out = $('#weatherResult');
    $out.html('<span class="text-muted">Lade Wetterdatenâ€¦</span>');

    const urlToday =
      `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}` +
      `&daily=temperature_2m_max,temperature_2m_min,precipitation_sum&forecast_days=1&timezone=Europe%2FZurich`;

    $.getJSON(urlToday)
      .done(function(data) {
        const daily = data.daily;
        if (!daily) {
          $out.html('<div class="text-danger">Keine Wetterdaten gefunden.</div>');
          return;
        }

        const tmax = daily.temperature_2m_max?.[0];
        const tmin = daily.temperature_2m_min?.[0];
        const rain = daily.precipitation_sum?.[0];

        $out.html(`
          <div>
            <p class="mb-2"><strong>Ort:</strong> ZÃ¼rich, CH</p>
            <p class="mb-0">
              Heute: Tmax ${tmax}Â°C,
              Tmin ${tmin}Â°C,
              Niederschlag ${rain} mm
            </p>
          </div>
        `);
      })
      .fail(function() {
        $out.html('<div class="text-danger">Fehler beim Abrufen der Wetterdaten.</div>');
      });
  });

  // =====================================
  // Teil 2: Highcharts 5-Tage-Vorhersage
  // =====================================

  $('#btnChart').on('click', function () {
    const $status = $('#chartStatus');
    $status.text('Lade Vorhersageâ€¦');

    // Neue URL: normaler forecast-Endpoint statt meteoswiss
    const url5days =
      `https://api.open-meteo.com/v1/forecast?latitude=${LAT}&longitude=${LON}` +
      `&hourly=temperature_2m,precipitation&forecast_days=5&timezone=Europe%2FZurich`;

    $.getJSON(url5days)
      .done(function(data) {
        const hourly = data.hourly;
        if (!hourly || !hourly.time || !hourly.temperature_2m || !hourly.precipitation) {
          $status.text('Konnte Vorhersage nicht laden ðŸ˜•');
          return;
        }

        // Highcharts-Serien vorbereiten
        const temperatureSeries = [];
        const rainSeries = [];

        for (let i = 0; i < hourly.time.length; i++) {
          const ts = new Date(hourly.time[i]).getTime(); // ISO -> ms
          const tempVal = hourly.temperature_2m[i];
          const rainVal = hourly.precipitation[i];

          temperatureSeries.push([ts, tempVal]);
          rainSeries.push([ts, rainVal]);
        }

        Highcharts.chart('weatherChart', {
          chart: {
            zoomType: 'x',
            backgroundColor: 'transparent'
          },
          title: {
            text: 'Temperatur & Niederschlag (nÃ¤chste 5 Tage)'
          },
          xAxis: {
            type: 'datetime',
            labels: { format: '{value:%d.%m %H:%M}' }
          },
          yAxis: [{
            title: { text: 'Temperatur (Â°C)' },
            opposite: false
          }, {
            title: { text: 'Niederschlag (mm)' },
            opposite: true
          }],
          tooltip: {
            shared: true,
            xDateFormat: '%d.%m.%Y %H:%M',
            headerFormat: '<b>{point.key}</b><br/>'
          },
          legend: {
            layout: 'horizontal'
          },
          series: [
            {
              name: 'Temperatur (Â°C)',
              type: 'spline',
              data: temperatureSeries,
              yAxis: 0
            },
            {
              name: 'Niederschlag (mm)',
              type: 'column',
              data: rainSeries,
              yAxis: 1
            }
          ]
        });

        $status.text('Diagramm geladen âœ”');
      })
      .fail(function() {
        $status.text('Fehler beim Laden der Vorhersage ðŸ˜¬');
      });
  });
</script>
</body>
</html>